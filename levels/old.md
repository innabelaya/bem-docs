Что такое уровни переопределния
Как они используются в проектах
Примеры применения 

## Что такое уровни переопределния

Уровень переопределения — это набор блоков, элементов и модификаторов и их полных или частичных реализаций. 

Уровень переопределения — это набор реализаций блоков, сгруппированных в одну директорию.

В файловой структуре уровень переопределния выглядит как группирующая директория, которая содержит директории БЭМ-сущностей с их исходными файлами реализаций. 

```files
project/
    level1/               # уровень переопределния 1 с набором блоков и их реализаций
        block1/
            __elem1/
                block1__elem1.js
            _mod1/
                block1_mod1.css
            block1.css
            block1.js
        block2/
            block2.css
            block2.js
```

Любой БЭМ-проект состоит из уровней переопределения. Количество уровней и содержащийся в них набор БЭМ-сущностей могут меняться, но в проекте всегда есть минимум один уровень. 

## Зачем нужны уровни переопределения

Уровни - это группирующие директории в файловой структуре проекта, по которым распределены все реализации блоков, элементов и модификаторов в проекте. 
Реализация блока может быть разделена по разным уровням переопределения или может находиться только на одном уровне. 




Результат использования уровней переопределения становится заметным, когда происходит сборка. В настройках сборщика необходимо указать, с каких уровней в какой последовательности собирать исходные файлы. 

> Почему мы разделяем код не по технологиям, а по блокам читай тут 

При сборке уровни накладываются друг на друга таким образом получается конечная реализация блока. 


Уровни можно сравнить со слоями в фотошопе. Есть базовый слой (уровень 1) с исходной реализацией блоков и есть дополнительный слой с  

Реализация любого блока библиотеки может быть расширена (или переопределена) на уровне проекта.

TODO картинка с уровнями


Уровни переопределения дают возможность:

* расширять или перекрывать исходную реализацию БЭМ-сущностей.
* подключать в проект дополнительные БЭМ-сущности (например, готовые блоки из сторонней библиотеки).
* Настраивать сборку проекта. Логически разделять сборку по требованию проекта. 




Реализация блока может быть разделена по разным уровням переопределения. Каждый дополнительный уровень добавляет или перекрывает исходную реализацию блока. Конечный результат собирается из отдельных технологий реализации блока со всех уровней переопределения последовательно в заданном порядке. Набор (множество) и последовательность используемых уровней указывается в параметрах при сборке.




Реализация блока может быть на нескольких уровнях. Для каждой страницы можно настроить своё используемое множество уровней. Финальная реализация блока на странице собирается со всех уровней для этой страницы.


```files
project/
    level1/               # уровень переопределния 1 с набором блоков и их реализаций
        block1/
            block1.css
            block1.js
        block2/
            block2.css
            block2.js
    level2/               # уровень переопределния 2 с набором блоков и их реализаций
        block1/
            block1.css
        block2/
            block2.js
        block3/
            block3.css
            block3.js
```


TODO пример для CSS. Но сказать, что работает во всех технологиях благодаря 


Примеры использования

Уровнем переопределения мы стали называть директории с реализацией блоков. Появление уровней позволило изменять реализацию блока, добавляя новые свойства (доопределять) или изменяя старые (переопределять) на другом уровне. Конечная реализация блока собирается со всех уровней последовательно.

Уровни переопределения позволяют:
Подключать библиотеки и обновлять их, не делая правок в коде.
Выделять общие части реализаций блоков на один уровень, а частные случаи (например, специфическую реализацию для отдельных сервисов) — на другой.
Разделять проект на платформы. Общую реализацию для всех платформ хранить на одном уровне, а платформо-специфичную — выносить на другой.
Экспериментировать в рабочем проекте.
Иметь разные дизайны проекта с одной и той же бизнесс-логикой.

Избежать копирования кода и создания новых сущностей, если необходимо изменить уже существующую функциональность.


Если сравнить уровни со слоями, то базовый слой – это исходная реализация блока, а каждый последующий слой накладывается сверху и дополняет (наследует) или изменяет базовую реализацию.


























1. Переопределения на уровнях
Если нам нужно, на некоторой странице иметь некий superInput, который чем-то отличается от базового input, то нам не обязательно именно придумывать новое имя и новый блок. Можно создать pages/index/blocks/input/input.js и положить туда BEM.DOM.decl('input', ... тут декларация полей и методов ...), эта декларация будет себя вести в точности как наследник базового blocks/input/input.js, т.е. будут доступны правильные this.__base() и this.__self.

На уровне переопределения проекта все блоки, определённые на уровне библиотеки блоков, расширяются с помощью API наследования. Это сделано по аналогии с CSS, ведь если на проекте есть blocks/input/input.css в котором .input { color: red }, то это будет расширять тот lib/blocks/input/input.css, который написан в библиотеке.














Уровни переопределения (http://www.artiom.pro/2012/09/blog-post.html)
Если группа блоков одного проекта (объединённая в папку) подключена к другому проекту напрямую (при помощи частичного чекаута или svn:externals), то любое закоммиченное изменение в таких блоках повлияет на оба проекта.
При разработке одного сайта на основе существующего может потребоваться:
Увеличить шрифт в Шапке на всём сайте (не затрагивая предыдущий сайт),
Добавить анимацию для раскрытия всех выпадающих меню.
То есть необходима возможность переопределять (или доопределять) блоки в разных технологиях только для определённого сайта или только для определённых страниц. Это возможно благодаря уровням переопределения.
Уровень переопределения — это набор реализаций блоков, сгруппированных в одну директорию.

Реализация любого блока библиотеки может быть расширена (или переопределена) на уровне проекта.

С точки зрения сборки страниц:
При сборке каждой страницы можно указать список уровней (директорий), блоки которых будут представлены на странице. Например,
build-page -l blocks-common -l blocks-my my-page.html
С точки зрения файловой структуры:
Проект можно содержать любое количество реализаций блоков. Но на страницу попадут только те, которые явно указаны к применению для сборки этой страницы. Возможно делать разные наборы уровней переопределения для разных разделов сайтов.
С точки зрения JavaScript
Необходима возможность декларативного описания динамического поведения элементов на странице. Конечное поведение должно собираться с разных уровней переопределения. Например,
/* blocks-common/dropdown/dropdown.js */
Block('dropdown', {
  init: function() {
    ...
  }
});

/* blocks-my/dropdown/dropdown.js */
Block('dropdown', {
  init: function() {
    this.__base();
    ...
  }
});
С точки зрения шаблонного движка
Для того, чтобы можно было не только переопределять, но и "доопределять" шаблон, нужна возможность вызвать предыдущую реализацию шаблона.
Например, в случае xsl:
<xsl:template match="b:head">
  <div> <!-- Node for extra design -->
    <xsl:apply-imports/>
  </div>
</xsl:template>
С точки зрения архитектуры проекта
При разработке портала из нескольких сайтов можно выделить общую библиотеку блоков, которая станет одним из уровней переопределения для всех сайтов портала. Блоки конкретного сайта — объединить в другой уровень переопределения.
В одном и том же репозитории может храниться реализация сайта для десктопных и мобильных браузеров.
В таком проекте есть уровень переопределения для общей реализации блоков, для мобильной и для десктопной. Различные комбинации уровней дают желаемую реализацию блоков на конкретных страницах.
Примером реализации нескольких уровней переопределения в одном репозитории может служить Open Source библиотека блоков bem-bl.
Сборка страниц

Работа со страницей в терминах блоков подразумевает предметную абстракцию. Эта предметная абстракция обязательна только на уровне взаимодействия человека с кодом. Когда код попадает в браузер, наличие предметной абстракции не обязательно, важно лишь сохранить требуемый внешний вид и поведение блоков на странице.
Таким образом, код для людей и код для браузеров — не одно и то же:
Человек пишет код блоков, браузер получает код целой страницы
Для того, чтобы превратить "код для людей" в "код для браузеров", существует понятие сборки страниц.
Сборка страницы — это формирование кода страницы в различных технологиях (HTML, CSS, JavaScript) на основе декларативного описания страницы (XML, JSON) путём применения реализаций описыванных блоков.
С точки зрения CSS
Файлы всех блоков собираются в один файл страницы
Несмотря на то, что CSS для каждого блока, элемента и модификатора реализован в отдельном файле, для работы страницы нет необходимости подключать эти файлы as is. Всю необходимую CSS-реализацию страницы можно собрать в один файл. К тому же это решает проблемы: ограниченного количества импортов в IE, количества HTTP-запросов к серверу. Объединение всех CSS в один файл мы делаем при помощи утилиты borschik.
Браузер получает минимизированный код
В процессе сборки можно минимизировать и оптимизировать CSS-код. Например, при помощи утилиты CSSO, прототип
Каждый браузер получает CSS, написанный специально для него
Есть возможность разделять CSS-реализации для разных браузеров и поставлять в каждый конкретный браузер только тот CSS, который нужен ему. Для этого можно использовать Сеточку
С точки зрения JavaScript
Много файлов для блоков, один файл для страницы
Так же, как и в случае CSS, JavaScript-реализация всех необходимых блоков может быть объединена в один файл.
С точки зрения шаблонных движков
Работают только нужные шаблоны
Конечный набор шаблонов, используемых для вывода HTML страницы в результате сборки содержит только шаблоны нужных блоков. Благодаря этому увеличивается производительность шаблонов и уменьшается вероятность возникновения побочных эффектов.
С точки зрения процесса разработки
Роботы на службе у человека (не наоборот)
Разработчик пишет код так, как ему удобно. О производительности заботятся роботы, которые в процессе сборки превращают код в оптимизированный (и, возможно, нечитаемый).
С точки зрения организации труда
Разделение труда
Существуют одни разработчики, создающие блоки, и существуют другие разработчики, занимающиеся оптимизацией конечного продукта.
Для сборки файлов страниц используются БЭМ-инструменты.



Уровень переопределения может содержать различный набор БЭМ-сущностей и их реализаций в зависимости от нужд проекта. (набор БЭМ-сущностей и их реализаций зависит от нужд проекта)
